{"title":"RabbitMQ部署指南","slug":"RabbitMQ部署","date":"2023-03-03T07:28:21.959Z","updated":"2023-03-03T08:09:57.161Z","comments":true,"path":"api/articles/RabbitMQ部署.json","photos":[],"link":"","excerpt":null,"covers":["http://localhost:4000/2023/03/03/RabbitMQ%E9%83%A8%E7%BD%B2/image-20210423191210349.png"],"content":"<h1 id=\"1-单机部署\"><a href=\"#1-单机部署\" class=\"headerlink\" title=\"1.单机部署\"></a>1.单机部署</h1><p>我们在Centos7虚拟机中使用Docker来安装。</p>\n<h2 id=\"1-1-下载镜像\"><a href=\"#1-1-下载镜像\" class=\"headerlink\" title=\"1.1.下载镜像\"></a>1.1.下载镜像</h2><p>方式一：在线拉取</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull rabbitmq:3-management</span><br></pre></td></tr></table></figure>\n\n\n\n<p>方式二：从本地加载</p>\n<p>在课前资料已经提供了镜像包：</p>\n<p><img src=\"http://localhost:4000/2023/03/03/RabbitMQ%E9%83%A8%E7%BD%B2/image-20210423191210349.png\" alt=\"image-20210423191210349\"> </p>\n<p>上传到虚拟机中后，使用命令加载镜像即可：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker load -i mq.tar</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"1-2-安装MQ\"><a href=\"#1-2-安装MQ\" class=\"headerlink\" title=\"1.2.安装MQ\"></a>1.2.安装MQ</h2><p>执行下面的命令来运行MQ容器：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run \\</span><br><span class=\"line\"> -e RABBITMQ_DEFAULT_USER=itcast \\</span><br><span class=\"line\"> -e RABBITMQ_DEFAULT_PASS=123321 \\</span><br><span class=\"line\"> --name mq \\</span><br><span class=\"line\"> --hostname mq1 \\</span><br><span class=\"line\"> -p 15672:15672 \\</span><br><span class=\"line\"> -p 5672:5672 \\</span><br><span class=\"line\"> -d \\</span><br><span class=\"line\"> rabbitmq:3-management</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h1 id=\"2-集群部署\"><a href=\"#2-集群部署\" class=\"headerlink\" title=\"2.集群部署\"></a>2.集群部署</h1><p>接下来，我们看看如何安装RabbitMQ的集群。</p>\n<h2 id=\"2-1-集群分类\"><a href=\"#2-1-集群分类\" class=\"headerlink\" title=\"2.1.集群分类\"></a>2.1.集群分类</h2><p>在RabbitMQ的官方文档中，讲述了两种集群的配置方式：</p>\n<ul>\n<li>普通模式：普通模式集群不进行数据同步，每个MQ都有自己的队列、数据信息（其它元数据信息如交换机等会同步）。例如我们有2个MQ：mq1，和mq2，如果你的消息在mq1，而你连接到了mq2，那么mq2会去mq1拉取消息，然后返回给你。如果mq1宕机，消息就会丢失。</li>\n<li>镜像模式：与普通模式不同，队列会在各个mq的镜像节点之间同步，因此你连接到任何一个镜像节点，均可获取到消息。而且如果一个节点宕机，并不会导致数据丢失。不过，这种方式增加了数据同步的带宽消耗。</li>\n</ul>\n<p>我们先来看普通模式集群。</p>\n<h2 id=\"2-2-设置网络\"><a href=\"#2-2-设置网络\" class=\"headerlink\" title=\"2.2.设置网络\"></a>2.2.设置网络</h2><p>首先，我们需要让3台MQ互相知道对方的存在。</p>\n<p>分别在3台机器中，设置 &#x2F;etc&#x2F;hosts文件，添加如下内容：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">192.168.150.101 mq1</span><br><span class=\"line\">192.168.150.102 mq2</span><br><span class=\"line\">192.168.150.103 mq3</span><br></pre></td></tr></table></figure>\n\n<p>并在每台机器上测试，是否可以ping通对方：</p>\n","categories":[],"tags":[]}